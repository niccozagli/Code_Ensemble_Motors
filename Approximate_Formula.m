function [gForceMF,Iformula2,Iformula4] = Approximate_Formula(yMF,zMF,Sigma_Fluct,N,f0)
    % Derived Parameters for population
    Sigma = N*Sigma_Fluct;
    nyMF = N * yMF; nzMF = N *zMF;
    
    % Approximate Formula
    % Zeroth order: Mean field approximation
    mu_ForceMF = 11/20*f0*nzMF;
    s2_ForceMF = ( 1/3*nyMF + nzMF *27/400 )*f0^2;
    
    gForceMF = @(f) 1/sqrt(2*pi*s2_ForceMF) .* exp(-1/2 * (f- mu_ForceMF).^2 /s2_ForceMF );
    
    % Second order
    h11 = @(f) get_hxx(f,f0,mu_ForceMF,s2_ForceMF);
    h22 = @(f) get_hyy(f,f0,mu_ForceMF,s2_ForceMF);
    h12 = @(f) get_hxy(f,f0,mu_ForceMF,s2_ForceMF);
    
    correction2 = @(f)  1/2*h11(f)*Sigma(1,1) + 1/2*h22(f)*Sigma(2,2) + h12(f)*Sigma(1,2);
     
    % Fourth order
    hxxxx = @(f) get_hxxxx(f,f0,mu_ForceMF,s2_ForceMF);
    hxxxy = @(f) get_hxxyx(f,f0,mu_ForceMF,s2_ForceMF);
    hxxyy = @(f) get_hxxyy(f,f0,mu_ForceMF,s2_ForceMF);
    hyyyx = @(f) get_hyyyx(f,f0,mu_ForceMF,s2_ForceMF);
    hyyyy = @(f) get_hyyyy(f,f0,mu_ForceMF,s2_ForceMF);
    
    
    correction4 = @(f) 1/factorial(4) * (3*Sigma(1,1)^2*hxxxx(f) + 3*Sigma(2,2)^2*hyyyy(f) + ...
                         12 *Sigma(1,1)*Sigma(1,2)* hxxxy(f) + 12*Sigma(2,2)*Sigma(1,2)*hyyyx(f)+...
                         6 * (2*Sigma(1,2)^2+Sigma(1,1)*Sigma(2,2)) *hxxyy(f)  )  ;
    
    % Integral
    
    Iformula2 = @(f) gForceMF(f) .* ( 1 + correction2(f));
    Iformula4 = @(f) gForceMF(f) .*( 1 + correction2(f) + correction4(f));
    
    
end

function hxx = get_hxx(f,f0,mu,s2)
    %    This function was generated by the Symbolic Math Toolbox version 9.3.
    %    23-Jan-2024 10:36:23
    hxx = f0.^4.*1.0./s2.^4.*(s2.^2.*6.0-(s2.*3.0-(f-mu).^2).^2).*(-1.0./3.6e+1);
end

function hxy = get_hxy(f,f0,mu,s2)
    %    This function was generated by the Symbolic Math Toolbox version 9.3.
    %    23-Jan-2024 10:36:23
    
    t2 = -mu;
    t3 = f+t2;
    t4 = t3.^2;
    t5 = -t4;
    hxy = f0.^3.*1.0./s2.^3.*(f0.*t4.*(2.7e+1./2.0e+1)-(s2.*3.0+t5).*(f.*-1.1e+1+mu.*1.1e+1+(f0.*(s2+t5).*(2.7e+1./4.0e+1))./s2)).*(-1.0./1.2e+2);
end

function hyy = get_hyy(f,f0,mu,s2)
    %    This function was generated by the Symbolic Math Toolbox version 9.3.
    %    23-Jan-2024 10:36:23
    
    t2 = f.*1.1e+1;
    t3 = -mu;
    t4 = mu.*1.1e+1;
    t5 = 1.0./s2;
    t6 = t5.^2;
    t7 = f+t3;
    t8 = t7.^2;
    t9 = -t8;
    hyy = f0.*(f0.*t5.*(f0.^2.*t6.*t8.*4.55625e-2+f0.*t5.*t7.*(2.97e+2./4.0e+2)+1.21e+2./2.0e+1)+(f0.*t5.*(t5.*(t2-t4)-f0.*t6.*(s2.*3.0+t9).*(2.7e+1./4.0e+1)).*(-t2+t4+f0.*t5.*(s2+t9).*(2.7e+1./4.0e+1)))./2.0e+1).*(-1.0./2.0e+1);
end

function hxxxx = get_hxxxx(f,f0,mu,s2)
    %    This function was generated by the Symbolic Math Toolbox version 9.3.
    %    23-Jan-2024 10:36:23
    
    t2 = f.^2;
    t3 = f.^3;
    t5 = f.^5;
    t7 = mu.^2;
    t8 = mu.^3;
    t10 = mu.^5;
    t12 = s2.^2;
    t13 = s2.^3;
    t4 = t2.^2;
    t6 = t2.^3;
    t9 = t7.^2;
    t11 = t7.^3;
    hxxxx = (f0.^8.*1.0./t12.^4.*(s2.*t6.*-2.8e+1-s2.*t11.*2.8e+1+t2.*t11.*2.8e+1-t3.*t10.*5.6e+1+t4.*t9.*7.0e+1-t5.*t8.*5.6e+1+t6.*t7.*2.8e+1-t2.*t13.*4.2e+2+t4.*t12.*2.1e+2-t7.*t13.*4.2e+2+t9.*t12.*2.1e+2-f.*mu.^7.*8.0-f.^7.*mu.*8.0+t4.^2+t9.^2+t12.^2.*1.05e+2+f.*mu.*t13.*8.4e+2+f.*s2.*t10.*1.68e+2-f.*t8.*t12.*8.4e+2+mu.*s2.*t5.*1.68e+2-mu.*t3.*t12.*8.4e+2-s2.*t2.*t9.*4.2e+2+s2.*t3.*t8.*5.6e+2-s2.*t4.*t7.*4.2e+2+t2.*t7.*t12.*1.26e+3))./1.296e+3;
end

function hxxyx = get_hxxyx(f,f0,mu,s2)
    %    This function was generated by the Symbolic Math Toolbox version 9.3.
    %    23-Jan-2024 10:36:23
    
    t2 = f.^2;
    t3 = f.^3;
    t5 = f.^5;
    t7 = f.^7;
    t8 = mu.^2;
    t9 = mu.^3;
    t11 = mu.^5;
    t13 = mu.^7;
    t14 = s2.^2;
    t15 = s2.^3;
    t4 = t2.^2;
    t6 = t2.^3;
    t10 = t8.^2;
    t12 = t8.^3;
    t16 = t14.^2;
    et1 = f.*t16.*-4.62e+4+f0.*t16.*2.835e+3+mu.*t16.*4.62e+4+s2.*t7.*4.4e+2-s2.*t13.*4.4e+2+t3.*t15.*4.62e+4-t5.*t14.*9.24e+3-t9.*t15.*4.62e+4+t11.*t14.*9.24e+3+f0.*t4.^2.*2.7e+1+f0.*t10.^2.*2.7e+1-f.*f0.*t13.*2.16e+2-f0.*mu.*t7.*2.16e+2-f0.*s2.*t6.*7.56e+2+f.*s2.*t12.*3.08e+3-f0.*s2.*t12.*7.56e+2+f0.*t2.*t12.*7.56e+2-f0.*t3.*t11.*1.512e+3+f0.*t4.*t10.*1.89e+3-f0.*t5.*t9.*1.512e+3+f0.*t6.*t8.*7.56e+2-f0.*t2.*t15.*1.134e+4+f0.*t4.*t14.*5.67e+3+f.*t8.*t15.*1.386e+5;
    et2 = f0.*t8.*t15.*-1.134e+4-f.*t10.*t14.*4.62e+4+f0.*t10.*t14.*5.67e+3-mu.*s2.*t6.*3.08e+3-mu.*t2.*t15.*1.386e+5+mu.*t4.*t14.*4.62e+4-s2.*t2.*t11.*9.24e+3+s2.*t3.*t10.*1.54e+4-s2.*t4.*t9.*1.54e+4+s2.*t5.*t8.*9.24e+3+t2.*t9.*t14.*9.24e+4-t3.*t8.*t14.*9.24e+4+f.*f0.*mu.*t15.*2.268e+4+f.*f0.*s2.*t11.*4.536e+3-f.*f0.*t9.*t14.*2.268e+4+f0.*mu.*s2.*t5.*4.536e+3-f0.*mu.*t3.*t14.*2.268e+4-f0.*s2.*t2.*t10.*1.134e+4+f0.*s2.*t3.*t9.*1.512e+4-f0.*s2.*t4.*t8.*1.134e+4;
    et3 = f0.*t2.*t8.*t14.*3.402e+4;
    hxxyx = (f0.^7.*1.0./t16.^2.*(et1+et2+et3))./1.728e+5;
end

function hxxyy = get_hxxyy(f,f0,mu,s2)

    
    %    This function was generated by the Symbolic Math Toolbox version 9.3.
    %    23-Jan-2024 10:36:23
    
    t2 = f.^2;
    t3 = f0.^2;
    t4 = f.^3;
    t6 = f.^5;
    t8 = f.^7;
    t9 = mu.^2;
    t10 = mu.^3;
    t12 = mu.^5;
    t14 = mu.^7;
    t15 = s2.^2;
    t16 = s2.^3;
    t5 = t2.^2;
    t7 = t2.^3;
    t11 = t9.^2;
    t13 = t9.^3;
    t17 = t15.^2;
    et1 = t2.*t17.*8.712e+6+t3.*t17.*7.6545e+4-t5.*t16.*2.904e+6+t7.*t15.*1.936e+5+t9.*t17.*8.712e+6-t11.*t16.*2.904e+6+t13.*t15.*1.936e+5+t3.*t5.^2.*7.29e+2+t3.*t11.^2.*7.29e+2-s2.^5.*2.904e+6-f.*f0.*t17.*2.4948e+6-f.*mu.*t17.*1.7424e+7+f0.*mu.*t17.*2.4948e+6+f0.*s2.*t8.*2.376e+4-f0.*s2.*t14.*2.376e+4-f.*t3.*t14.*5.832e+3+f0.*t4.*t16.*2.4948e+6-f0.*t6.*t15.*4.9896e+5+f.*t10.*t16.*1.1616e+7;
    et2 = f0.*t10.*t16.*-2.4948e+6-f.*t12.*t15.*1.1616e+6+f0.*t12.*t15.*4.9896e+5-mu.*t3.*t8.*5.832e+3+mu.*t4.*t16.*1.1616e+7-mu.*t6.*t15.*1.1616e+6-s2.*t3.*t7.*2.0412e+4-s2.*t3.*t13.*2.0412e+4+t2.*t3.*t13.*2.0412e+4-t3.*t4.*t12.*4.0824e+4+t3.*t5.*t11.*5.103e+4-t3.*t6.*t10.*4.0824e+4+t3.*t7.*t9.*2.0412e+4-t2.*t3.*t16.*3.0618e+5+t3.*t5.*t15.*1.5309e+5-t2.*t9.*t16.*1.7424e+7+t2.*t11.*t15.*2.904e+6-t3.*t9.*t16.*3.0618e+5+t3.*t11.*t15.*1.5309e+5;
    et3 = t4.*t10.*t15.*-3.872e+6+t5.*t9.*t15.*2.904e+6+f.*f0.*s2.*t13.*1.6632e+5+f.*f0.*t9.*t16.*7.4844e+6-f.*f0.*t11.*t15.*2.4948e+6-f0.*mu.*s2.*t7.*1.6632e+5-f0.*mu.*t2.*t16.*7.4844e+6+f.*mu.*t3.*t16.*6.1236e+5+f0.*mu.*t5.*t15.*2.4948e+6-f0.*s2.*t2.*t12.*4.9896e+5+f.*s2.*t3.*t12.*1.22472e+5+f0.*s2.*t4.*t11.*8.316e+5-f0.*s2.*t5.*t10.*8.316e+5+f0.*s2.*t6.*t9.*4.9896e+5+f0.*t2.*t10.*t15.*4.9896e+6-f.*t3.*t10.*t15.*6.1236e+5;
    et4 = f0.*t4.*t9.*t15.*-4.9896e+6+mu.*s2.*t3.*t6.*1.22472e+5-mu.*t3.*t4.*t15.*6.1236e+5-s2.*t2.*t3.*t11.*3.0618e+5+s2.*t3.*t4.*t10.*4.0824e+5-s2.*t3.*t5.*t9.*3.0618e+5+t2.*t3.*t9.*t15.*9.1854e+5;
    hxxyy = (t3.^3.*1.0./t17.^2.*(et1+et2+et3+et4))./2.304e+7;
end

function hyyyx = get_hyyyx(f,f0,mu,s2)
    %    This function was generated by the Symbolic Math Toolbox version 9.3.
    %    23-Jan-2024 10:36:23
    
    t2 = f.^2;
    t3 = f0.^2;
    t4 = f.^3;
    t5 = f0.^3;
    t7 = f.^5;
    t9 = f.^7;
    t10 = mu.^2;
    t11 = mu.^3;
    t13 = mu.^5;
    t15 = mu.^7;
    t16 = s2.^2;
    t17 = s2.^3;
    t19 = s2.^5;
    t6 = t2.^2;
    t8 = t2.^3;
    t12 = t10.^2;
    t14 = t10.^3;
    t18 = t16.^2;
    et1 = f.*t19.*1.27776e+9-f0.*t19.*2.35224e+8-mu.*t19.*1.27776e+9-t4.*t18.*8.5184e+8+t5.*t18.*2.066715e+6+t7.*t17.*8.5184e+7+t11.*t18.*8.5184e+8-t13.*t17.*8.5184e+7+t5.*t6.^2.*1.9683e+4+t5.*t12.^2.*1.9683e+4-f.*t5.*t15.*1.57464e+5+f0.*t2.*t18.*7.05672e+8-f.*t3.*t18.*1.010394e+8-f0.*t6.*t17.*2.35224e+8+f0.*t8.*t16.*1.56816e+7;
    et2 = f.*t10.*t18.*-2.55552e+9+f0.*t10.*t18.*7.05672e+8+f.*t12.*t17.*4.2592e+8-f0.*t12.*t17.*2.35224e+8+f0.*t14.*t16.*1.56816e+7-mu.*t5.*t9.*1.57464e+5+mu.*t2.*t18.*2.55552e+9+mu.*t3.*t18.*1.010394e+8-mu.*t6.*t17.*4.2592e+8+s2.*t3.*t9.*9.6228e+5-s2.*t5.*t8.*5.51124e+5-s2.*t3.*t15.*9.6228e+5-s2.*t5.*t14.*5.51124e+5+t2.*t5.*t14.*5.51124e+5-t4.*t5.*t13.*1.102248e+6;
    et3 = t5.*t6.*t12.*1.37781e+6-t5.*t7.*t11.*1.102248e+6+t5.*t8.*t10.*5.51124e+5-t2.*t5.*t17.*8.26686e+6+t3.*t4.*t17.*1.010394e+8-t3.*t7.*t16.*2.020788e+7+t5.*t6.*t16.*4.13343e+6-t2.*t11.*t17.*8.5184e+8-t3.*t11.*t17.*1.010394e+8+t4.*t10.*t17.*8.5184e+8+t3.*t13.*t16.*2.020788e+7-t5.*t10.*t17.*8.26686e+6+t5.*t12.*t16.*4.13343e+6-f.*f0.*mu.*t18.*1.411344e+9+f.*f0.*t11.*t17.*9.40896e+8;
    et4 = f.*f0.*t13.*t16.*-9.40896e+7+f0.*mu.*t4.*t17.*9.40896e+8+f.*mu.*t5.*t17.*1.653372e+7-f0.*mu.*t7.*t16.*9.40896e+7+f.*s2.*t3.*t14.*6.73596e+6+f.*s2.*t5.*t13.*3.306744e+6-f0.*t2.*t10.*t17.*1.411344e+9+f.*t3.*t10.*t17.*3.031182e+8+f0.*t2.*t12.*t16.*2.35224e+8-f.*t3.*t12.*t16.*1.010394e+8-f0.*t4.*t11.*t16.*3.13632e+8-f.*t5.*t11.*t16.*1.653372e+7+f0.*t6.*t10.*t16.*2.35224e+8-mu.*s2.*t3.*t8.*6.73596e+6;
    et5 = mu.*s2.*t5.*t7.*3.306744e+6-mu.*t2.*t3.*t17.*3.031182e+8+mu.*t3.*t6.*t16.*1.010394e+8-mu.*t4.*t5.*t16.*1.653372e+7-s2.*t2.*t3.*t13.*2.020788e+7-s2.*t2.*t5.*t12.*8.26686e+6+s2.*t3.*t4.*t12.*3.36798e+7-s2.*t3.*t6.*t11.*3.36798e+7+s2.*t3.*t7.*t10.*2.020788e+7+s2.*t4.*t5.*t11.*1.102248e+7-s2.*t5.*t6.*t10.*8.26686e+6+t2.*t3.*t11.*t16.*2.020788e+8+t2.*t5.*t10.*t16.*2.480058e+7-t3.*t4.*t10.*t16.*2.020788e+8;
    hyyyx = (f0.^5.*1.0./t18.^2.*(et1+et2+et3+et4+et5))./3.072e+9;
end

function hyyyy = get_hyyyy(f,f0,mu,s2)
  
    %    This function was generated by the Symbolic Math Toolbox version 9.3.
    %    23-Jan-2024 10:36:23
    
    t2 = f.^2;
    t3 = f0.^2;
    t4 = f.^3;
    t5 = f0.^3;
    t8 = f.^5;
    t10 = f.^7;
    t11 = mu.^2;
    t12 = mu.^3;
    t14 = mu.^5;
    t16 = mu.^7;
    t17 = s2.^2;
    t18 = s2.^3;
    t20 = s2.^5;
    t6 = t2.^2;
    t7 = t3.^2;
    t9 = t2.^3;
    t13 = t11.^2;
    t15 = t11.^3;
    t19 = t17.^2;
    et1 = t2.*t20.*-2.2488576e+11-t3.*t20.*1.2702096e+10+t6.*t19.*3.748096e+10+t7.*t19.*5.5801305e+7-t11.*t20.*2.2488576e+11+t13.*t19.*3.748096e+10+t6.^2.*t7.*5.31441e+5+t7.*t13.^2.*5.31441e+5+t17.^3.*1.1244288e+11+f.*f0.*t20.*1.3799808e+11+f.*mu.*t20.*4.4977152e+11-f0.*mu.*t20.*1.3799808e+11-f.*t7.*t16.*4.251528e+6;
    et2 = f0.*t4.*t19.*-9.199872e+10-f.*t5.*t19.*3.6374184e+9+f0.*t8.*t18.*9.199872e+9-f.*t12.*t19.*1.4992384e+11+f0.*t12.*t19.*9.199872e+10-f0.*t14.*t18.*9.199872e+9-mu.*t7.*t10.*4.251528e+6-mu.*t4.*t19.*1.4992384e+11+mu.*t5.*t19.*3.6374184e+9+s2.*t5.*t10.*3.464208e+7-s2.*t7.*t9.*1.4880348e+7-s2.*t5.*t16.*3.464208e+7-s2.*t7.*t15.*1.4880348e+7;
    et3 = t2.*t3.*t19.*3.8106288e+10+t2.*t7.*t15.*1.4880348e+7-t4.*t7.*t14.*2.9760696e+7+t6.*t7.*t13.*3.720087e+7-t2.*t7.*t18.*2.2320522e+8-t3.*t6.*t18.*1.2702096e+10+t4.*t5.*t18.*3.6374184e+9-t7.*t8.*t12.*2.9760696e+7+t7.*t9.*t11.*1.4880348e+7+t3.*t9.*t17.*8.468064e+8-t5.*t8.*t17.*7.2748368e+8+t6.*t7.*t17.*1.1160261e+8+t2.*t11.*t19.*2.2488576e+11+t3.*t11.*t19.*3.8106288e+10;
    et4 = t3.*t13.*t18.*-1.2702096e+10+t3.*t15.*t17.*8.468064e+8-t5.*t12.*t18.*3.6374184e+9+t5.*t14.*t17.*7.2748368e+8-t7.*t11.*t18.*2.2320522e+8+t7.*t13.*t17.*1.1160261e+8-f.*f0.*t11.*t19.*2.7599616e+11+f.*f0.*t13.*t18.*4.599936e+10+f0.*mu.*t2.*t19.*2.7599616e+11-f.*mu.*t3.*t19.*7.6212576e+10-f0.*mu.*t6.*t18.*4.599936e+10+f.*mu.*t7.*t18.*4.4641044e+8+f.*s2.*t5.*t15.*2.4249456e+8;
    et5 = f.*s2.*t7.*t14.*8.9282088e+7-f0.*t2.*t12.*t18.*9.199872e+10+f.*t3.*t12.*t18.*5.0808384e+10+f0.*t4.*t11.*t18.*9.199872e+10-f.*t3.*t14.*t17.*5.0808384e+9+f.*t5.*t11.*t18.*1.09122552e+10-f.*t5.*t13.*t17.*3.6374184e+9-f.*t7.*t12.*t17.*4.4641044e+8-mu.*s2.*t5.*t9.*2.4249456e+8+mu.*s2.*t7.*t8.*8.9282088e+7-mu.*t2.*t5.*t18.*1.09122552e+10+mu.*t3.*t4.*t18.*5.0808384e+10;
    et6 = mu.*t3.*t8.*t17.*-5.0808384e+9-mu.*t4.*t7.*t17.*4.4641044e+8+mu.*t5.*t6.*t17.*3.6374184e+9-s2.*t2.*t5.*t14.*7.2748368e+8-s2.*t2.*t7.*t13.*2.2320522e+8+s2.*t4.*t5.*t13.*1.2124728e+9+s2.*t4.*t7.*t12.*2.9760696e+8-s2.*t5.*t6.*t12.*1.2124728e+9+s2.*t5.*t8.*t11.*7.2748368e+8-s2.*t6.*t7.*t11.*2.2320522e+8-t2.*t3.*t11.*t18.*7.6212576e+10+t2.*t3.*t13.*t17.*1.2702096e+10;
    et7 = t2.*t5.*t12.*t17.*7.2748368e+9-t3.*t4.*t12.*t17.*1.6936128e+10+t2.*t7.*t11.*t17.*6.6961566e+8+t3.*t6.*t11.*t17.*1.2702096e+10-t4.*t5.*t11.*t17.*7.2748368e+9;
    hyyyy = (t7.*1.0./t19.^2.*(et1+et2+et3+et4+et5+et6+et7))./4.096e+11;
end


